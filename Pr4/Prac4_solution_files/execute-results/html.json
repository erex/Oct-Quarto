{
  "hash": "51e0885db73c103c289bb973a8691bc0",
  "result": {
    "markdown": "---\ntitle: Variance estimation for systematic survey designs **solution**\nauthor: Centre for Research into Ecological and Environmental Modelling <br> **University of St Andrews**\ndate: \"2022-10-23\"\nbibliography: references.bib\ncsl: apa.csl\n---\n\n\n\n\n:::{.callout-tip}\n# Solution\n\nVariance estimatino for systematic designs\n:::\n\n\n# Basic (default) variance estimation\n\nRecall the data for this example, in which we have a strong gradient in animal density across our study region and at the same time we have a difference in the lengths of the transects, such that short transects are in regions of high animal density and long transects are in regions of low animal density.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(Distance)\ndata(\"Systematic_variance_2\")\nconversion.factor <- convert_units(\"metre\", \"kilometre\", \"square kilometre\")\n# Fit a simple model\nsysvar2.hn <- ds(data=Systematic_variance_2, key=\"hn\", adjustment=\"cos\",\n                 convert_units=conversion.factor)\nsysvar2.hn$dht$individuals$D\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  Label Estimate       se        cv      lcl      ucl       df\n1 Total 2044.592 566.3958 0.2770214 1161.012 3600.614 20.74468\n```\n:::\n\n```{.r .cell-code}\nsysvar2.hn$dht$individuals$N\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  Label Estimate       se        cv     lcl      ucl       df\n1 Total 1022.296 283.1979 0.2770214 580.506 1800.307 20.74468\n```\n:::\n:::\n\n\nThe point estimates are good ($\\hat D = 2,044$ animals per unit area and $\\hat N=1,022$ - note the size of the area) but the precision obtained with the default estimator is poor: estimated abundance ranges from about 580 to 1,800 - a three-fold difference over which we are uncertain. Given that our survey covered 40% of the triangular region and had a good sample size (254 animals on 20 transects), this would be a disappointing result in practice.\n\n# Variance estimation with bootstrapping\n\nThe function `bootdht_Nhat_summarize` pulls out the estimates of abundance $(\\hat{N_i})$ for all bootstrap replicates $i = 1, \\cdots, N_{boot}$ where $N_{boot}$ is the number of replicates requested.\n\nThe following command performs the bootstrap.\n\n\n::: {.cell quiet='true' suppress_messages='true'}\n\n```{.r .cell-code}\nest.boot <- bootdht(model=sysvar2.hn, flatfile=Systematic_variance_2,\n                    summary_fun=bootdht_Nhat_summarize, \n                    convert_units=conversion.factor, nboot=100)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(est.boot)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nBootstrap results\n\nBoostraps          : 100 \nSuccesses          : 100 \nFailures           : 0 \n\n     median   mean     se    lcl     ucl   cv\nNhat 924.05 982.86 283.65 520.99 1590.85 0.31\n```\n:::\n:::\n\n\nThe bootstrap results are very similar to the analytical results, as we would expect, because again this process assumed the transects were placed at random.\n\n# Post-stratification to improve variance estimation\n\n\n::: {.cell}\n\n```{.r .cell-code}\n## Post-stratification by O2 estimator\n# ensure that Sample.Labels are numeric, for O2 ordering\nSystematic_variance_2$Sample.Label <- as.numeric(Systematic_variance_2$Sample.Label)\n# Using the Fewster et al 2009, \"O2\" estimator \nest.O2 <- dht2(sysvar2.hn, flatfile=Systematic_variance_2,   strat_formula=~1, convert_units=conversion.factor, er_est=\"O2\")\nprint(est.O2, report=\"density\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nDensity estimates from distance sampling\nStratification : geographical \nVariance       : O2, n/L \nMultipliers    : none \nSample fraction : 1 \n\n\nSummary statistics:\n .Label Area CoveredArea Effort   n  k     ER se.ER cv.ER\n  Total  0.5      0.1922   9.61 254 20 26.431 1.459 0.055\n\nDensity estimates:\n .Label Estimate      se   cv      LCI      UCI     df\n  Total 2044.592 162.914 0.08 1744.988 2395.636 75.871\n\nComponent percentages of variance:\n .Label Detection    ER\n  Total     52.03 47.97\n```\n:::\n:::\n\n\nThe precision of the estimated abundance has greatly improved in the post-stratified analysis [@fewster2009] .\n\nIt must be remembered that we have not made any change to our data by the post-stratification; we are using getting a better estimate of the variance. In this case, the increase in precision could make a fundamental difference to the utility of the survey: it might make the difference between being able to make a management decision or not. Usually, trends will not be as extreme as they are in this example and post-stratification will not make a great difference. Such an situation is illustrated in the next problem.\n\n# Systematic designs where post-stratification is not needed (optional)\n\nThese data did not exhibit strong trends across the survey region and, hence, there are no great differences between the CVs and 95% confidence intervals using the two methods.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Access the data\ndata(\"Systematic_variance_1\")\n# Ensure that Sample.Labels are numeric, for O2 ordering\nSystematic_variance_1$Sample.Label <- as.numeric(Systematic_variance_1$Sample.Label)\n# First fit a simple model\nsysvar1.hn <- ds(Systematic_variance_1, key=\"hn\", adjustment=NULL, \n                 convert_units=conversion.factor)\n# Obtain default estimates for comparison\nsysvar1.hn$dht$individuals$D\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  Label Estimate       se         cv      lcl      ucl       df\n1 Total 1954.016 160.5554 0.08216688 1657.276 2303.888 50.59541\n```\n:::\n\n```{.r .cell-code}\nsysvar1.hn$dht$individuals$N\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  Label Estimate       se         cv      lcl      ucl       df\n1 Total 977.0078 80.27768 0.08216688 828.6378 1151.944 50.59541\n```\n:::\n\n```{.r .cell-code}\n# Now use Fewster et al 2009, \"O2\" estimator \nest2.O2 <- dht2(sysvar1.hn, flatfile=Systematic_variance_1, strat_formula=~1,\n                convert_units=conversion.factor, er_est=\"O2\")\nprint(est2.O2, report=\"density\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nDensity estimates from distance sampling\nStratification : geographical \nVariance       : O2, n/L \nMultipliers    : none \nSample fraction : 1 \n\n\nSummary statistics:\n .Label Area CoveredArea Effort   n  k    ER se.ER cv.ER\n  Total  0.5      0.2058  10.29 252 20 24.49 1.594 0.065\n\nDensity estimates:\n .Label Estimate      se    cv      LCI      UCI     df\n  Total 1954.015 162.491 0.083 1653.804 2308.723 49.172\n\nComponent percentages of variance:\n .Label Detection    ER\n  Total     38.76 61.24\n```\n:::\n:::\n\n\n# References\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}